<div class="min-h-screen">
  <div class="bg-white px-6 mt-4 py-4 sticky top-0 z-10">
    <div class="flex items-center gap-4">
      <button (click)="goBack()" class="text-gray-600 hover:text-gray-900">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <h1 class="text-xl font-bold text-gray-900">Add Expense</h1>
    </div>
  </div>

  <form [formGroup]="expenseForm" (ngSubmit)="onSubmit()" class="p-6 space-y-6 max-w-md mx-auto">
    <div>
      <label class="block text-sm font-semibold text-gray-900 mb-2"> Categories </label>
      <mat-form-field appearance="fill" class="w-full custom-material-field">
        <mat-select formControlName="category" placeholder="Select category" class="custom-select">
          @for (cat of categoryOptions; track cat) {
          <mat-option [value]="cat.name">
            <span class="flex items-center gap-3">
              <lucide-icon
                [name]="category.getCategoryIcon(cat.name)"
                [size]="20"
                class="text-gray-600"
              ></lucide-icon>
              <span>{{ cat.name }}</span>
            </span>
          </mat-option>
          }
        </mat-select>
        <mat-icon matSuffix>expand_more</mat-icon>
      </mat-form-field>
    </div>

    <div>
      <label class="block text-sm font-semibold text-gray-900 mb-2"> Amount </label>
      <div class="flex gap-3">
        <mat-form-field appearance="fill" class="flex-1 custom-material-field">
          <input
            matInput
            type="number"
            formControlName="amount"
            placeholder="50,000"
            step="0.01"
            min="0"
          />
          <span matPrefix class="text-gray-600 mr-2">{{ getCurrencySymbol() }}</span>
        </mat-form-field>

        <mat-form-field appearance="fill" class="w-24 custom-material-field">
          <mat-select formControlName="currency">
            @for (curr of currencies; track $index) {
            <mat-option [value]="curr.code">
              {{ curr.code }}
            </mat-option>
            }
          </mat-select>
          <mat-icon matSuffix>expand_more</mat-icon>
        </mat-form-field>
      </div>
      @if (isFieldInvalid('amount')) {
      <p class="text-red-500 text-sm -mt-4">Please enter a valid amount</p>
      }
    </div>

    <div>
      <label class="block text-sm font-semibold text-gray-900"> Date </label>
      <mat-form-field appearance="fill" class="w-full custom-material-field">
        <input matInput [matDatepicker]="picker" formControlName="date" placeholder="02/01/24" />
        <mat-datepicker-toggle matIconSuffix [for]="picker">
          <lucide-icon
            matDatepickerToggleIcon
            [img]="CalendarDays"
            [size]="20"
            class="text-gray-600"
          ></lucide-icon>
        </mat-datepicker-toggle>
        <mat-datepicker #picker></mat-datepicker>
      </mat-form-field>
    </div>

    <div>
      <label class="block text-sm font-semibold text-gray-900 mb-3"> Attach Receipt </label>
      <input
        type="file"
        #fileInput
        (change)="onFileSelected($event)"
        accept="image/*,.pdf"
        class="hidden"
      />
      <button
        type="button"
        (click)="fileInput.click()"
        class="w-full px-4 py-3 bg-gray-50 rounded-xl text-left flex items-center justify-between text-gray-500 hover:bg-gray-100 transition-colors"
      >
        <span>{{ selectedFileName || 'Upload Image' }}</span>
        <mat-icon class="text-gray-400">photo_camera</mat-icon>
      </button>
    </div>

    <div>
      <h3 class="text-sm font-semibold text-gray-900 mb-4">Categories</h3>
      <div class="grid grid-cols-4 gap-3">
        @for (cat of categoryOptions; track cat) {
        <button
          type="button"
          (click)="selectCategory(cat.name)"
          class="flex flex-col items-center gap-2 p-3 transition-all"
        >
          <div
            class="flex-1 p-5 flex items-center rounded-full justify-center"
            [style.background-color]="
              expenseForm.get('category')?.value === cat.name ? cat.color : '#F3F4F6'
            "
          >
            <lucide-icon
              [name]="category.getCategoryIcon(cat.name)"
              [size]="20"
              [class.text-white]="expenseForm.get('category')?.value === cat.name"
              [class.text-gray-700]="expenseForm.get('category')?.value !== cat.name"
            ></lucide-icon>
          </div>
          <span class="text-xs font-medium text-center text-gray-700">
            {{ cat.name }}
          </span>
        </button>
        }

        <button type="button" class="flex flex-col items-center gap-2 p-3">
          <div class="flex-1 p-5 flex items-center rounded-full justify-center">
            <lucide-icon [img]="Plus" [size]="20" class="text-gray-600"></lucide-icon>
          </div>
          <span class="text-xs font-medium text-gray-600 text-center">Add Category</span>
        </button>
      </div>
    </div>

    <button
      type="submit"
      [disabled]="expenseForm.invalid || isSubmitting"
      class="w-full btn-primary mt-8 disabled:opacity-50 disabled:cursor-not-allowed"
      [disabled]="expenseForm.invalid || isSubmitting"
    >
      @if (!isSubmitting) {
      <span>Save</span>
      } @if (isSubmitting) {
      <span class="flex items-center justify-center gap-2">
        <mat-icon class="animate-spin">refresh</mat-icon>
        Saving...
      </span>
      }
    </button>
  </form>
</div>
